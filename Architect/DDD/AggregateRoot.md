# Aggregate Root
```md
Aggregate(聚合）是一组相关对象的集合，作为一个整体被外界访问，聚合根（Aggregate Root）是这个聚合的根节点。
```
```md
是一种更大范围的封装，把一组有相同生命周期、在业务上不可分隔的实体和值对象放在一起考虑，
只有根实体可以对外暴露引用，也是一种内聚性的表现。
```
```md
聚合是一个非常重要的概念，核心领域往往都需要用聚合来表达。
其次，聚合在技术上有非常高的价值，可以指导详细设计。
```
```md
聚合由根实体，值对象和实体组成。
```
```md
看银行的例子，Account（账号）是CustomerInfo（客户信息）Entity和Address（值对象）的聚合根，
Transaction（交易）是流水（Journal）的聚合根，因为流水是因为交易才产生的，具有相同的生命周期。
```
```md
最后提醒一下，聚合根是一个逻辑概念，主观性很强，所以在建模过程中很容易产生分歧，因此在日常工作中千万不要教条，
把握住一条主要原则，我们的最终目的是为了业务语义显现化，如果因为聚合根把模型弄的晦涩难懂那就得不偿失了
```
* 如何创建好的聚合？
```md
边界内的内容具有一致性:
    在一个事务中只修改一个聚合实例。
    如果你发现边界内很难接受强一致，不管是出于性能或产品需求的考虑，应该考虑剥离出独立的聚合，采用最终一致的方式。
设计小聚合
    大部分的聚合都可以只包含根实体，而无需包含其他实体。即使一定要包含，可以考虑将其创建为值对象。
通过唯一标识来引用其他聚合或实体
    当存在对象之间的关联时，建议引用其唯一标识而非引用其整体对象。
    如果是外部上下文中的实体，引用其唯一标识或将需要的属性构造值对象。 
    如果聚合创建复杂，推荐使用工厂方法来屏蔽内部复杂的创建逻辑。
```
```md
聚合内部多个组成对象的关系可以用来指导数据库创建，但不可避免存在一定的抗阻。
如聚合中存在List<值对象>，那么在数据库中建立1:N的关联需要将值对象单独建表，此时是有id的，建议不要将该id暴露到资源库外部，对外隐蔽。
```
